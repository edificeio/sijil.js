!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/http"),require("rxjs/add/operator/toPromise")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/http","rxjs/add/operator/toPromise"],t):t(e.SijilModule=e.SijilModule||{},e.ng.core,e.ng.http,e.Rx)}(this,function(e,t,n,r){"use strict";function i(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function a(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function o(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var u=function(){function e(e){this.http=e}return e.prototype.load=function(e){return this.http.get(e).toPromise().then(function(e){return e.json()})},e=a([t.Injectable(),o("design:paramtypes",["function"==typeof(r="undefined"!=typeof n.Http&&n.Http)&&r||Object])],e);var r}(),s=function(){function e(){}return e}(),l=function(e){function t(t,n){e.call(this,t),this.message=t,this.fragment=n}return i(t,e),t}(Error),f=function(){function e(){}return e}(),c=function(){function e(){}return e.prototype.getParameter=function(e,t,n){var r=t.split(/\s+/);return 1===r.length?"$"===t[0]?e[t.substr(1)]:n?t:e[t]||t:t.split(/\s+/).reduce(function(t,n){return t.push("$"===n[0]?e[n.substr(1)]:n),t},[]).join(" ")},e.prototype.compileFragment=function(e,t){e=e.replace(/{{|}}/g,"");var n,r;if(!((n=e.indexOf("?"))>0&&(r=e.lastIndexOf(":"))>1))return e=e.trim(),t[e];var i=e.substring(0,n).trim(),a=e.substring(n+1,r).trim(),o=e.substring(r+1).trim(),u=this.getParameter(t,a),s=this.getParameter(t,o),f=i.split(/\s+/);if(1===f.length){var c=t[f[0]];return c?u:s}if(3!==f.length)throw new l("Invalid condition for fragment : "+e,e);var p=this.getParameter(t,f[0],t instanceof Array),d=this.getParameter(t,f[2],t instanceof Array),g=f[1];switch(g){case"==":return p==d?u:s;case">":return p>d?u:s;case">=":return p>=d?u:s;case"<":return p<d?u:s;case"<=":return p<=d?u:s;default:throw new l("Invalid conditional operator for fragment : "+e,e)}},e.prototype.compile=function(t,n,r){var i=t.split(e.delimRegexp),a=t.match(e.delimRegexp),o="";if(r||(r=e.defaultErrorCallback),a){for(var u=0;u<i.length;u++)if(o+=i[u],!(u>a.length-1))try{o+=this.compileFragment(a[u],n)}catch(e){o+=r(e)}}else o+=t;return o},e.delimiters=["{{","}}"],e.delimRegexp=new RegExp(e.delimiters[0]+"[^}]+"+e.delimiters[1],"gm"),e.defaultErrorCallback=function(e){return console.error(e),e.fragment},e}(),p=function(){function e(e,t,n){this.requireService=e,this.parser=t,this.bundles={},this.defaultLanguage=n.defaultLanguage,this.defaultLanguage||"undefined"==typeof window||(this.defaultLanguage=window.navigator.language.split("-")[0]),this.currentLanguage=this.defaultLanguage}return e.prototype.addToBundle=function(e,t){var n=t||this.currentLanguage||this.defaultLanguage||"en";this.bundles[n]||(this.bundles[n]={});var r={},i={};for(var a in e)r[a]=e[a];for(var a in i)r[a]=i[a];this.bundles[n]=r,this.currentLanguage||(this.currentLanguage=t)},e.prototype.loadBundle=function(e,t){var n=this;return this.requireService.load(e).then(function(e){n.addToBundle(e,t)})},e.prototype.loadBundles=function(e){var t=this;return Promise.all(e.map(function(e){return t.loadBundle(e.where,e.lang)}))},e.prototype.unloadBundle=function(e){delete this.bundles[e]},e.prototype.getLoadedLanguages=function(){return Object.keys(this.bundles)},e.prototype.translate=function(e,t,n){var r=n||this.currentLanguage,i=this.bundles[r]&&this.bundles[r][e]||this.defaultLanguage&&this.bundles[this.defaultLanguage]&&this.bundles[this.defaultLanguage][e]||e;return i!==e&&t?this.parser.compile(i,t,function(t){return console.error(t),e}):i},e}(),d=function(){function e(){}return e}(),g={defaultLanguage:"undefined"!=typeof window?window.navigator.language.split("-")[0]:void 0},h=function(){function e(e,t){this.bundlesService=e,this.changeDetectorRef=t,this.bundleRef=null}return e.prototype.refreshTranslation=function(){this.wrapperRef.nativeElement.innerHTML=this.bundlesService.translate(this.value,this.parameters,this.fixedLanguage)},e.prototype.ngAfterViewInit=function(){this.value=this.wrapperRef.nativeElement.innerHTML.trim(),this.loaded=!0,this.bundleRef=this.bundlesService.bundles[this.fixedLanguage||this.bundlesService.currentLanguage],this.refreshTranslation()},e.prototype.ngDoCheck=function(){var e=this.bundlesService.bundles[this.fixedLanguage||this.bundlesService.currentLanguage];this.loaded&&this.bundleRef!==e&&(this.bundleRef=e,this.refreshTranslation())},a([t.ViewChild("wrapper"),o("design:type","function"==typeof(n="undefined"!=typeof t.ElementRef&&t.ElementRef)&&n||Object)],e.prototype,"wrapperRef"),a([t.Input("s5l-params"),o("design:type",Object)],e.prototype,"parameters"),a([t.Input("s5l-lang"),o("design:type",String)],e.prototype,"fixedLanguage"),e=a([t.Component({selector:"s5l",template:"\n    <span #wrapper>\n        <ng-content></ng-content>\n    </span>",changeDetection:t.ChangeDetectionStrategy.OnPush}),o("design:paramtypes",["function"==typeof(r="undefined"!=typeof p&&p)&&r||Object,"function"==typeof(i="undefined"!=typeof t.ChangeDetectorRef&&t.ChangeDetectorRef)&&i||Object])],e);var n,r,i}(),m=function(){function e(e){this.bundlesService=e}return e.prototype.transform=function(e,t,n){return this.bundlesService.translate(e,t,n)},e=a([t.Pipe({name:"translate",pure:!1}),o("design:paramtypes",["function"==typeof(n="undefined"!=typeof p&&p)&&n||Object])],e);var n}(),y=[{provide:p,useClass:p,deps:[s,f,d]},{provide:s,useClass:u},{provide:f,useClass:c},{provide:d,useValue:g}],v=function(){function e(){}return e.forRoot=function(t,n,r){return y[1].useClass=t||u,y[2].useClass=n||c,y[3].useValue=r||g,{ngModule:e,providers:y}},e=a([t.NgModule({imports:[n.HttpModule],declarations:[h,m],providers:y,exports:[h,m]}),o("design:paramtypes",[])],e)}();e.SijilModule=v,e.HttpRequireService=u,e.RequireService=s,e.FragmentsParser=c,e.ParserError=l,e.Parser=f,e.BundlesService=p,e.defaultSijilOpts=g,e.SijilOpts=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sijil.module.umd.js.map
